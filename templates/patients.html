{% extends "layout.html" %}
{% block content %}
<style>
    @import url('https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700');


    body{
        background: radial-gradient(#FFFFFF,#87cefa);
    }
    .btnctrl{
        margin-top:05%;
    }
    .tblcont{
        margin-top: 05%;
    }
    
.table {
	width:100%;
	/*border:1px solid aqua;*/
}

.table-header {
	display:block;
	width:100%;
	background:#a1d2fa;
	padding: 0;
}

.table-row {
	display:flex;
	width:100%;
	
}

.table-data, .header__item {
	flex: 1 1 20%;
	text-align:center;
}

/*form css*/
.modal-box{
  top: 40%;
  opacity: 0;
  visibility: hidden;
  background: white;
  height: auto;
  width: 220px;
  padding: 18px 10px;
  border-radius: 5px;
  box-shadow: 5px 5px 30px rgba(0,0,0,.2);
}

.start-btn.show-modal{
  opacity: 0;
  visibility: hidden;
}
.modal-box.show-modal{
  top: 50%;
  opacity: 1;
  visibility: visible;
  transition: .4s;
}
.modal-box .fa-times{
  position: absolute;
  top: 0;
  right: 0;
  background: #0569d4;
  height: 40px;
  width: 40px;
  line-height: 40px;
  margin: 10px;

  color: white;
  font-size: 18px;
  border-radius: 100%;
  text-align: center;
  cursor: pointer;
}
.fa-times:hover{
  font-size: 22px;
}


.form_container{

  background: #fff;
  padding: 30px;
  margin-top: 20px;
  border-radius: 3px;
}

.form_container .form_item{
  margin-bottom: 25px;
}

.form_container .form_wrap.form_grp{
  display:flex;
}

.form_container .form_wrap.form_grp .form_item{
  width: 50%;
}

.form_container .form_wrap.form_grp .form_item:first-child{
  margin-right: 4%;
}

.form_container .form_item label{
  display: block;
  margin-bottom: 5px;
}

.form_container .form_item input,
.form_container .form_item select{
  width: 50%;
  padding: 10px;
  font-size: 16px;
  border: 1px solid #dadce0;
  border-radius: 3px;
}
 
.form_container .btn input[type="submit"]{
  background: #6271f0;
  border: 1px solid #6271f0;
  padding: 10px;
  width: 100%;
  border-radius: 3px;
  cursor: pointer;
  color: #fff;
}
</style>
<div>
  <h3>Patient Details</h3>
  {% if success %}
      <div class="col-4 alert alert-success" role="alert" id="form_success">
      Patient Data Added Successfully!
      </div>
  {% endif %}
  {% if failed %}
      <div class="col-4 alert alert-danger" role="alert" id="form_success">
          Error While Adding Data
      </div>
  {% endif %}
</div>
<div class="col-10">
        <div class="btnctrl">
        <a class="btn btn-primary" data-toggle="modal" data-target="#AddPatients">Add Patients</a>
    </div>
    <div style="margin-top:100px;">
        <table class="table">
            <thead class="thead-dark" >
            <tr>
                <th scope="col">Patient Id</th>
                <th scope="col">Name</th>
                <th scope="col">Email_id</th>
                <th scope="col">Mobile</th>
                <th scope="col">Gender</th>
                <th scope="col">DOB</th>
                
                <th scope="col">Address</th>
                <th scope="col">Blood Group</th>
                <th scope="col">Referred Doctor ID</th>
            </tr>
            </thead>
            <tbody>
                {%for i in range(0, data_len)%}
                <tr>
                    {%for j in range(0, 10)%}
                        <td>{{data[i][j]}}</td>
                    {%endfor%}
                </tr>
                {%endfor%}
            </tbody>
        </table>
    </div>
    <!--Add Patients form-->
    <div class="modal fade" id="AddPatients" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
          <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLongTitle">Add Patient Details</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
          </button>
          </div>
          <div class="modal-body">
              <form class="col-12 form-horizontal"  id="patient_form" method="POST" action="http://127.0.0.1:5000/patients">
                  <div class="alert alert-danger toogle" role="alert"  id="form_validate">
                  </div>
                  <div class="row">
                      <div class="form-group col">
                          <label for="patient_id"><b>Patient ID</b></label>
                          <input type="text" class="form-control" id="patient_id" name="patient_id" placeholder="{{patient_id}}" value="{{patient_id}}" required readonly >
                      </div>
                      <div class="form-group col">
                          <label for="patient_name"><b>Patient Name</b></label>
                          <input type="text" class="form-control" id="patient_name" name="patient_name" placeholder="Patient's Full Name" required >
                      </div>
                  </div>
                  <div class="row">
                      <div class="form-group col">
                          <label for="patient_email"><b>Email address</b></label>
                          <input type="email" class="form-control" id="patient_email" name="patient_email" placeholder="Enter email" required >
                      </div>
                      <div class="form-group col">
                          <label for="patient_mobile"><b>Mobile</b></label>
                          <input type="text" class="form-control" id="patient_mobile" name="patient_mobile" placeholder="Mobile Number" required >
                      </div>
                  </div>
                  <div class="row">
                      <div class="form-group col">
                          <label for="patient_gender"><b>Gender</b></label>
                          <select class="dropdown form-control" name="patient_gender" id="patient_gender" required>
                              <option value="dummy">Select a Gender</option>
                              <option value="male">Male</option>
                              <option value="female">Female</option>
                              <option value="others">Others</option>
                          </select>
                      </div>
                      <div class="form-group col">
                          <label for="patient_DOB"><b>Date Of Birth</b></label>
                          <input type="date" onchange="ageCalculator()" class="form-control" name="patient_DOB" id="patient_DOB" required>
                      </div>
                  </div>
                  <div class="row">
                      <div class="form-group col">
                          <label for="patient_age"><b>Age</b></label>
                          <input type="number" class="form-control" id="patient_age" name="patient_age"  readonly >
                          <br>
                          <label for="patient_blood_group"><b>Blood Group</b></label>
                          <select class="dropdown form-control" name="patient_bloodgroup"  id="patient_bloodgroup" required>
                              <option value="dummy">Select a Blood Group</option>
                              <option value="A+">A+</option>
                              <option value="A-">A-</option>
                              <option value="B+">B+</option>
                              <option value="B-">B-</option>
                              <option value="O+">O+</option>
                              <option value="O-">O-</option>
                              <option value="AB+">AB+</option>
                              <option value="AB-">AB-</option>
                          </select>
                      </div>
                      
                      <div class="form-group col">
                          <label for="exampleInputEmail1"><b>Address</b></label>
                          <textarea class="form-control" id="patient_address" name="patient_address" rows="5" name="" form="patient_form" placeholder="Address" required></textarea>
                      </div>
                    </div>
                      <div class="row">
                        <div class="form-group col">
                          <label for="referred_doc"><b>Referred Doctor ID</b></label>
                          <input type="text" class="form-control" id="reff_docid" name="reff_docid"  required >
                        </div>
    
                    </div>
              </form>
          </div>
          <div class="modal-footer">
          <button style="background-color:#03abff ;color: black;" type="button" class="btn btn-primary" data-dismiss="modal" >Cancel</button>
          <button style="background-color:#03abff ;color: black;" type="button" class="btn btn-success" onclick="validateform()">Add Patient</button>
          </div>
      </div>
      </div>
  </div>
</div>
<script>
var age=null
function ageCalculator() {  
        var userinput = document.getElementById("patient_DOB").value;  
        var dob = new Date(userinput);  
        var month_diff = Date.now() - dob.getTime();  
        var age_dt = new Date(month_diff);   
        var year = age_dt.getUTCFullYear();  
        age = Math.abs(year - 1970);  
        return document.getElementById("patient_age").value = age;
    }  

    function validateform(){  
        const patient_id = document.getElementById("patient_id").value;
        const patient_name = document.getElementById("patient_name").value;
        const patient_email = document.getElementById("patient_email").value;
        const patient_mobile = document.getElementById("patient_mobile").value;
        const patient_DOB = document.getElementById("patient_DOB").value;      
        const patient_address = document.getElementById("patient_address").value;
        const patient_gender = document.getElementById("patient_gender").value;
        const patient_blood_group = document.getElementById("patient_bloodgroup").value;
        

        if ("{{patient_id}}"!=patient_id) 
        {
            document.getElementById("form_validate").classList.remove("toogle");
            document.getElementById("form_validate").innerHTML = "Invalid Patient Id";
            return false;

        }
        else if (patient_name.length < 2 || patient_name.length > 20) 
        {
            document.getElementById("form_validate").classList.remove("toogle");
            document.getElementById("form_validate").innerHTML = "Name is too Short or too Long!";
            name.focus();
            return false;

        }
        else if (!patient_email.match(/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/)) 
        {
            document.getElementById("form_validate").classList.remove("toogle");
            document.getElementById("form_validate").innerHTML = "Please enter a valid email!";
            email.focus();
            return false;

        }
        else if (!patient_mobile.match(/^[1-9][0-9]{9}$/)) 
        {
            document.getElementById("form_validate").classList.remove("toogle");
            document.getElementById("form_validate").innerHTML = "Invalid Mobile Number";
            mobile.focus();
            return false;

        }
        else if (patient_gender=="dummy") 
        {
            document.getElementById("form_validate").classList.remove("toogle");
            document.getElementById("form_validate").innerHTML = "Please Select Gender";
            bg.focus();
            return false;

        }  
        else if (patient_DOB == null || patient_DOB == "" ) 
        {
            document.getElementById("form_validate").classList.remove("toogle");
            document.getElementById("form_validate").innerHTML = "Invaild Date of Birth";
            dob.focus();
            return false;
        }
        else if (patient_address.length < 2 || patient_address.length > 250) 
        {
            document.getElementById("form_validate").classList.remove("toogle");
            document.getElementById("form_validate").innerHTML = "Address is too short or too Long";
            address.focus();
            return false;
        }
        else if (patient_bloodgroup=="dummy") 
        {
            document.getElementById("form_validate").classList.remove("toogle");
            document.getElementById("form_validate").innerHTML = "Please Select a Blood Group!";
            bg.focus();
            return false;

        }  
         
        else
        {
            document.getElementById("form_validate").classList.add("toogle");
            document.getElementById("patient_form").submit();
        }
     }
</script>
{% endblock content %}